<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciwi.mapper.mypage-mapper">
	<resultMap type="MemberVO" id="MemberAllMap">
		<result property="id" column="id"/>
		<result property="name" column="name"/>
		<result property="phone" column="phone"/>
		<result property="post" column="post"/>
		<result property="main_addr" column="main_addr"/>
		<result property="genre" column="genre"/>
		<result property="cvo.cash_pay" column="cash_pay"/>
	</resultMap>
<!-- 나의정보:session의 아이디가져오기-->
	<select id="myinformation" resultType="MemberVO" parameterType="String">
		select id,name,phone,post,main_addr,genre,
		(Select sum(cash_pay) From cash Where cash_id=#{id}) as cash_pay
		From member m,cash c
		Where m.id=#{id}  
	</select>
	<!-- 보유캐시 출력 -->
	<select id="cashTotalData" resultType="int" parameterType="CashVO">
		select cash_pay from cash
		where cash_state=#{cash_state}
		and cash_pay=#{cash_pay}
	</select>	
	<!-- 캐시충전 -->
	<insert id="cashchargeUpdate" parameterType="CashVO">
	<selectKey keyProperty="cash_no" resultType="int" order="BEFORE">
			select NVL(max(cash_no)+1,1) as cash_no from cash
		</selectKey>
		INSERT INTO cash VALUES(
			#{	cash_no},
			#{cash_id},
			sysdate,
			#{cash_pay},
			0
		)
	</insert>
	<!-- 결제내역 출력 -->
	<select id="cashManageData" resultType="CashVO">
		select * from cash
	</select>
	<!-- 결제내역 : 승인완료 -->
	<update id="cashOkData" parameterType="String">
		update cash set cash_state=1
		where cash_id=#{cash_id}
	</update>
</mapper>









