<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ciwi.mapper.festival-mapper">
	<resultMap type="FestivalVO" id="">
		<result property="fno" column="fno" />
		<result property="place" column="place" />
		<result property="subject" column="subject" />
		<result property="poster" column="poster" />
		<result property="fdate" column="fdate" />
		<result property="host" column="host" />
		<result property="homepage" column="homepage" />
		<result property="tel" column="tel" />
		<result property="showtime" column="showtime" />
		<result property="flike" column="flike" />
		<result property="festival_genre" column="concert_genre" />
		<result property="category_no" column="category_no" />
		<result property="area_no" column="area_no" />
		<result property="fgvo.festival_genre" column="fgvo" />
		<result property="ccvo.category_name" column="category_name" />
		<result property="avo.area_name" column="area_name" />
	</resultMap>
	<insert id="festivalDataInsert" parameterType="FestivalVO">
		<!-- {} = get메소드 -->
		Insert Into festival Values(
		#{fno},
		#{place},
		#{subject},
		#{poster},
		#{fdate},
		#{host},
		#{homepage},
		#{tel},
		#{showtime},
		#{flike},
		 #{festival_no},
         #{category_no},
         #{area_no}
		)
	</insert>
	<select id="festivalAllData" resultType="FestivalVO">
		Select fno, poster,
		subject, host, fdate, place
		From festival
	</select>

	<select id="festivalDetail" resultType="FestivalVO"
		parameterType="int">
		Select *
		From festival
		Where fno=#{fno}
	</select>

	<select id="festivalSearch" resultMap="" parameterType="java.util.Map">
		SELECT fno,subject,poster,fdate,cg.concert_genre as concert_genre,
		c.category_name as category_name, a.area_name as area_name
		FROM festival f, category c, area a,concert_genre cg
		WHERE f.concert_genre =
		cg.concert_no
		AND f.category_no = c.category_no
		AND f.area_no = a.area_no
      <if test='searchOption.equals("제목")'>
      <if test='text!=null  and !text.equals("")'>
      AND regexp_like(subject,'#{text}')
      </if>
      </if>      
      <if test='searchOption.equals("내용")'>
      <if test='text!=null  and !text.equals("")'>
      AND regexp_like(content,#{text})
      </if>
      </if>
      <if test=' area!=null and !area.equals("")'>
      AND area_name = #{festival_area}
      </if>
      <if test='genre!=null and !genre.equals("") '>
      AND show_genre = #{festival_genre}
      </if>
      ORDER BY fno ASC
	</select>
</mapper>